{% extends 'generic/object.html' %}
{% load render_table from django_tables2 %}
  {% block content %}
<div class="row mb-3">
  <!-- Main info -->
  <div class="col col-md-6">
    <table class="table table-hover attr-table">
      <tr><th>Name</th><td>{{ object.name }}</td></tr>
      <tr><th>Vendor</th><td>{{ object.vendor|linkify }}</td></tr>
      <tr><th>Tenant</th><td>{{ object.tenant|linkify }}</td></tr>
      <tr><th>External ID</th><td>{{ object.external_id|default:"â€”" }}</td></tr>
      <tr><th>Price</th><td>{{ object.price }} {{ object.currency }}</td></tr>
      <tr><th>Currency</th><td>{{ object.currency }}</td></tr>
      <tr><th>Comments</th><td>{{ object.comments|linebreaksbr }}</td></tr>
    </table>
  </div>

  <!-- Enhanced Utilization Panel -->
  <div class="col col-md-6">
    <table class="table table-hover attr-table">
      <tr>
        <th>License Utilization</th>
        <td>
          {% if is_overallocated %}
            <span class="badge text-bg-danger">{{ utilization_percentage|floatformat:1 }}% ({{ object.consumed_licenses }}/{{ object.total_licenses }})</span>
          {% elif is_underutilized %}
            <span class="badge text-bg-success">{{ utilization_percentage|floatformat:1 }}% ({{ object.consumed_licenses }}/{{ object.total_licenses }})</span>
          {% else %}
            <span class="badge text-bg-warning">{{ utilization_percentage|floatformat:1 }}% ({{ object.consumed_licenses }}/{{ object.total_licenses }})</span>
          {% endif %}
        </td>
      </tr>
      <tr><th>Total Licenses</th><td>{{ object.total_licenses }}</td></tr>
      <tr><th>Consumed Licenses</th><td>{{ object.consumed_licenses }}</td></tr>
      <tr>
        <th>Available Licenses</th>
        <td>
          {% if available_licenses < 0 %}
            <span class="text-danger">{{ available_licenses }} (Overallocated)</span>
          {% elif available_licenses == 0 %}
            <span class="text-warning">{{ available_licenses }} (Full capacity)</span>
          {% else %}
            <span class="text-success">{{ available_licenses }}</span>
          {% endif %}
        </td>
      </tr>
      <tr><th>Instance count</th><td>{{ instance_count|default:0 }}</td></tr>
      <tr><th>Total cost</th><td>{{ object.total_cost|default:0 }} NOK</td></tr>
    </table>
  </div>
</div>

<!-- License Instances Table -->
{% if instance_table.rows %}
<div class="card">
  <div class="card-header d-flex justify-content-between align-items-center">
    <h5 class="mb-0">Instances</h5>
    <a href="{% url 'plugins:netbox_licenses:licenseinstance_add' %}?license={{ object.pk }}" class="btn btn-sm btn-primary">
      + Add Instance
    </a>
  </div>
  <div class="card-body table-responsive">
    {% render_table instance_table 'inc/table.html' %}
  </div>
</div>
{% endif %}

{% endblock content %}
